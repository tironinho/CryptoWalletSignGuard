{
  "version": 3,
  "sources": ["../src/shared/utils.ts", "../src/runtimeSafe.ts", "../src/content.ts"],
  "sourcesContent": ["export function clamp(n: number, a: number, b: number) {\n  return Math.max(a, Math.min(b, n));\n}\n\nexport function hostFromUrl(url: string): string {\n  try {\n    return new URL(url).hostname.toLowerCase();\n  } catch {\n    return \"\";\n  }\n}\n\nexport function normalizeDomainLine(s: string) {\n  return (s || \"\").trim().toLowerCase().replace(/^\\.+/, \"\").replace(/\\.+$/, \"\");\n}\n\nexport function isAllowlisted(host: string, allowlist: string[]) {\n  const h = (host || \"\").toLowerCase();\n  return allowlist.some((d) => {\n    const dom = normalizeDomainLine(d);\n    if (!dom) return false;\n    return h === dom || h.endsWith(\".\" + dom);\n  });\n}\n\n/** Normalize host for comparison: lowercase, trim trailing dot. Do NOT strip www when storing. */\nexport function normalizeHost(host: string): string {\n  return (host || \"\").toLowerCase().replace(/\\.+$/, \"\").trim();\n}\n\n/** Match host to domain: exact or subdomain. Do NOT use endsWith(domain) without dot. */\nexport function isHostMatch(host: string, domain: string): boolean {\n  const h = normalizeHost(host);\n  const d = (domain || \"\").toLowerCase().trim();\n  if (!d) return false;\n  return h === d || h.endsWith(\".\" + d);\n}\n\n/** Normalize address: lowercase 0x + 40 hex. Returns \"\" if invalid. */\nexport function normalizeAddress(addr: string): string {\n  const s = (addr || \"\").trim();\n  const hex = s.startsWith(\"0x\") ? s.slice(2) : s;\n  if (hex.length !== 40 || !/^[a-fA-F0-9]{40}$/.test(hex)) return \"\";\n  return \"0x\" + hex.toLowerCase();\n}\n\n/** Build cache key for token (chainId:addressLower). */\nexport function normalizeTokenKey(chainId: string, addr: string): string {\n  const a = normalizeAddress(addr);\n  const c = (chainId || \"\").toLowerCase().replace(/^0x/, \"\") || \"0\";\n  return `${c}:${a}`;\n}\n\nexport function isHexString(v: any): v is string {\n  return typeof v === \"string\" && /^0x[0-9a-fA-F]*$/.test(v);\n}\n\nexport function hexSelector(data: string) {\n  if (!isHexString(data) || data.length < 10) return null;\n  return data.slice(0, 10).toLowerCase();\n}\n\nexport function escapeHtml(s: any) {\n  const str = String(s ?? \"\");\n  return str\n    .replaceAll(\"&\", \"&amp;\")\n    .replaceAll(\"<\", \"&lt;\")\n    .replaceAll(\">\", \"&gt;\")\n    .replaceAll('\"', \"&quot;\")\n    .replaceAll(\"'\", \"&#039;\");\n}\n\n", "/**\r\n * Centralized runtime/storage wrappers to avoid \"Cannot read properties of undefined\"\r\n * and \"Extension context invalidated\" errors. Use in content and options scripts only.\r\n * Uses Port (long-lived) to reduce runtime.lastError / SW sleeping issues.\r\n */\r\n\r\nlet _port: chrome.runtime.Port | null = null;\r\n\r\n/** Safe check: avoid crash when context invalidated. Use globalThis.chrome when available. */\r\nexport function canUseRuntime(): boolean {\r\n  try {\r\n    const c = (typeof globalThis !== \"undefined\" ? (globalThis as any).chrome : undefined) ?? (typeof chrome !== \"undefined\" ? chrome : undefined);\r\n    return !!(c?.runtime?.id && typeof c.runtime.sendMessage === \"function\");\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function isRuntimeUsable(): boolean {\r\n  try {\r\n    return canUseRuntime();\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nconst CONTEXT_INVALID_TERMS = [\r\n  \"extension context invalidated\",\r\n  \"context invalidated\",\r\n  \"message port closed\",\r\n  \"receiving end does not exist\",\r\n  \"runtime.lastError\",\r\n];\r\n\r\nfunction isContextInvalidError(e: unknown): boolean {\r\n  const msg = String((e as Error)?.message ?? e ?? \"\").toLowerCase();\r\n  return CONTEXT_INVALID_TERMS.some((t) => msg.includes(t));\r\n}\r\n\r\nfunction getPort(): chrome.runtime.Port | null {\r\n  try {\r\n    const c = (typeof globalThis !== \"undefined\" ? (globalThis as any).chrome : undefined) ?? (typeof chrome !== \"undefined\" ? chrome : undefined);\r\n    if (!canUseRuntime() || !c?.runtime?.connect) return null;\r\n    if (_port) return _port;\r\n    _port = c.runtime.connect({ name: \"sg_port\" });\r\n    _port?.onDisconnect.addListener(() => {\r\n      _port = null;\r\n      _portListenerInit = false;\r\n    });\r\n    return _port;\r\n  } catch {\r\n    _port = null;\r\n    return null;\r\n  }\r\n}\r\n\r\nconst _portPending = new Map<string, (r: any) => void>();\r\nlet _portListenerInit = false;\r\n\r\nfunction initPortListener() {\r\n  const p = getPort();\r\n  if (!p || _portListenerInit) return;\r\n  _portListenerInit = true;\r\n  p.onMessage.addListener((resp: any) => {\r\n    const cb = resp?.requestId != null ? _portPending.get(String(resp.requestId)) : undefined;\r\n    if (cb) {\r\n      _portPending.delete(String(resp.requestId));\r\n      try { cb(resp); } catch {}\r\n    }\r\n  });\r\n}\r\n\r\n/** Port-based request (preferred over sendMessage to avoid runtime.lastError). Sends PING via sendMessage first if port not yet connected (wakes SW). */\r\nexport function portRequest<T = any>(msg: unknown, timeoutMs = 2500): Promise<T | null> {\r\n  return new Promise((resolve) => {\r\n    (async () => {\r\n      try {\r\n        if (!_port) {\r\n          try {\r\n            await new Promise<void>((r) => {\r\n              const c = (typeof globalThis !== \"undefined\" ? (globalThis as any).chrome : undefined) ?? (typeof chrome !== \"undefined\" ? chrome : undefined);\r\n              if (!c?.runtime?.sendMessage) return r();\r\n              c.runtime.sendMessage({ type: \"PING\" }, () => {\r\n                r();\r\n              });\r\n              setTimeout(() => r(), 600);\r\n            });\r\n          } catch {\r\n            // ignore\r\n          }\r\n        }\r\n        const p = getPort();\r\n        if (!p) {\r\n          resolve(null);\r\n          return;\r\n        }\r\n        initPortListener();\r\n        const requestId = typeof crypto?.randomUUID === \"function\" ? crypto.randomUUID() : `sg_${Date.now()}_${Math.random().toString(36).slice(2)}`;\r\n        const payload = { ...(msg as object), requestId };\r\n\r\n        const timer = setTimeout(() => {\r\n          if (_portPending.has(requestId)) {\r\n            _portPending.delete(requestId);\r\n            resolve(null);\r\n          }\r\n        }, timeoutMs);\r\n\r\n        _portPending.set(requestId, (resp: any) => {\r\n          clearTimeout(timer);\r\n          resolve(resp != null ? (resp as T) : null);\r\n        });\r\n\r\n        try {\r\n          p.postMessage(payload);\r\n        } catch (e) {\r\n          clearTimeout(timer);\r\n          _portPending.delete(requestId);\r\n          resolve(null);\r\n        }\r\n      } catch {\r\n        resolve(null);\r\n      }\r\n    })();\r\n  });\r\n}\r\n\r\nconst DEFAULT_SEND_MS = 4000;\r\nconst RETRY_SEND_MS = 2500;\r\nconst LOG_PREFIX = \"[SignGuard]\";\r\n\r\nexport type SafeSendMessageOptions = {\r\n  timeoutMs?: number;\r\n  preferPort?: boolean;\r\n};\r\n\r\nfunction sendMessageOneAttempt<T>(msg: unknown, timeoutMs: number): Promise<T | null> {\r\n  return new Promise((resolve) => {\r\n    let settled = false;\r\n    const once = (value: T | null) => {\r\n      if (settled) return;\r\n      settled = true;\r\n      resolve(value);\r\n    };\r\n\r\n    const c = (typeof globalThis !== \"undefined\" ? (globalThis as any).chrome : undefined) ?? (typeof chrome !== \"undefined\" ? chrome : undefined);\r\n    const rt = (() => {\r\n      try {\r\n        return c?.runtime ?? null;\r\n      } catch {\r\n        return null;\r\n      }\r\n    })();\r\n    if (!rt || !rt.id || typeof rt.sendMessage !== \"function\") {\r\n      once(null);\r\n      return;\r\n    }\r\n\r\n    const timer = setTimeout(() => {\r\n      once(null);\r\n    }, timeoutMs);\r\n\r\n    try {\r\n      rt.sendMessage(msg, (resp: T) => {\r\n        if (settled) return;\r\n        clearTimeout(timer);\r\n        try {\r\n          const err = (c?.runtime as any)?.lastError;\r\n          if (err) {\r\n            once(null);\r\n            return;\r\n          }\r\n          once(resp ?? null);\r\n        } catch {\r\n          once(null);\r\n        }\r\n      });\r\n    } catch (e) {\r\n      clearTimeout(timer);\r\n      // Production: no console.warn; keep only console.error in critical catch blocks\r\n      once(null);\r\n    }\r\n  });\r\n}\r\n\r\nexport function safeSendMessage<T = any>(msg: unknown, options?: number | SafeSendMessageOptions): Promise<T | null> {\r\n  const timeoutMs = typeof options === \"number\" ? options : (options?.timeoutMs ?? DEFAULT_SEND_MS);\r\n  const preferPort = typeof options === \"object\" && options?.preferPort === true;\r\n\r\n  if (preferPort) {\r\n    return portRequest<T>(msg, timeoutMs).then((r) => {\r\n      if (r != null && (r as any)?.ok !== false) return r as T;\r\n      return sendMessageOneAttempt<T>(msg, timeoutMs).then((res) => {\r\n        if (res != null) return res;\r\n        return sendMessageOneAttempt<T>(msg, RETRY_SEND_MS);\r\n      });\r\n    });\r\n  }\r\n\r\n  return sendMessageOneAttempt<T>(msg, timeoutMs).then((r) => {\r\n    if (r != null) return r;\r\n    return sendMessageOneAttempt<T>(msg, RETRY_SEND_MS);\r\n  });\r\n}\r\n\r\nexport type StorageResult<T> = { ok: true; data: T } | { ok: false; error: string };\r\n\r\nexport async function safeStorageGet<T = any>(keys: unknown): Promise<StorageResult<T>> {\r\n  return new Promise((resolve) => {\r\n    try {\r\n      if (!isRuntimeUsable() || !chrome?.storage?.sync) {\r\n        resolve({ ok: false, error: \"storage_unavailable\" });\r\n        return;\r\n      }\r\n      chrome.storage.sync.get(keys as any, (items: T) => {\r\n        try {\r\n          const err = chrome.runtime.lastError;\r\n          if (err) {\r\n            resolve({ ok: false, error: err.message || String(err) });\r\n            return;\r\n          }\r\n          resolve({ ok: true, data: items });\r\n        } catch (e) {\r\n          resolve({ ok: false, error: (e as Error)?.message || String(e) });\r\n        }\r\n      });\r\n    } catch (e) {\r\n      resolve({ ok: false, error: (e as Error)?.message || String(e) });\r\n    }\r\n  });\r\n}\r\n\r\nexport async function safeStorageSet(obj: Record<string, unknown>): Promise<StorageResult<true>> {\r\n  return new Promise((resolve) => {\r\n    try {\r\n      if (!isRuntimeUsable() || !chrome?.storage?.sync) {\r\n        resolve({ ok: false, error: \"storage_unavailable\" });\r\n        return;\r\n      }\r\n      chrome.storage.sync.set(obj, () => {\r\n        try {\r\n          const err = chrome.runtime.lastError;\r\n          if (err) {\r\n            resolve({ ok: false, error: err.message || String(err) });\r\n            return;\r\n          }\r\n          resolve({ ok: true, data: true });\r\n        } catch (e) {\r\n          resolve({ ok: false, error: (e as Error)?.message || String(e) });\r\n        }\r\n      });\r\n    } catch (e) {\r\n      resolve({ ok: false, error: (e as Error)?.message || String(e) });\r\n    }\r\n  });\r\n}\r\n\r\nexport async function safeLocalGet<T = any>(key: string): Promise<T | null> {\r\n  return new Promise((resolve) => {\r\n    try {\r\n      if (!isRuntimeUsable() || !chrome?.storage?.local) {\r\n        resolve(null);\r\n        return;\r\n      }\r\n      chrome.storage.local.get(key, (r: Record<string, T>) => {\r\n        try {\r\n          const err = chrome.runtime.lastError;\r\n          if (err) {\r\n            resolve(null);\r\n            return;\r\n          }\r\n          resolve(((r as any)?.[key] as T) ?? null);\r\n        } catch {\r\n          resolve(null);\r\n        }\r\n      });\r\n    } catch {\r\n      resolve(null);\r\n    }\r\n  });\r\n}\r\n\r\nexport async function safeLocalSet(obj: Record<string, unknown>): Promise<boolean> {\r\n  return new Promise((resolve) => {\r\n    try {\r\n      if (!isRuntimeUsable() || !chrome?.storage?.local) {\r\n        resolve(false);\r\n        return;\r\n      }\r\n      chrome.storage.local.set(obj, () => {\r\n        try {\r\n          const err = chrome.runtime.lastError;\r\n          resolve(!err);\r\n        } catch {\r\n          resolve(false);\r\n        }\r\n      });\r\n    } catch {\r\n      resolve(false);\r\n    }\r\n  });\r\n}\r\n\r\n/** Safe getURL - returns empty string if runtime unusable */\r\nexport function safeGetURL(path: string): string {\r\n  try {\r\n    if (!isRuntimeUsable() || !chrome.runtime.getURL) return \"\";\r\n    return chrome.runtime.getURL(path);\r\n  } catch {\r\n    return \"\";\r\n  }\r\n}\r\n", "// ARQUIVO: src/content.ts\r\nimport type { AnalyzeRequest, Analysis, Settings } from \"./shared/types\";\r\nimport { DEFAULT_SETTINGS } from \"./shared/types\";\r\nimport { SUGGESTED_TRUSTED_DOMAINS } from \"./shared/constants\";\r\nimport { selectorToLabel } from \"./shared/signatures\";\r\nimport { t } from \"./i18n\";\r\nimport { clamp, escapeHtml } from \"./shared/utils\";\r\nimport { normMethod } from \"./shared/normalize\";\r\nimport { classifyAction, type SGAction } from \"./shared/classifyAction\";\r\nimport { actionTitle, simpleSummary } from \"./shared/actionTexts\";\r\nimport { extractTx } from \"./shared/txExtract\";\r\nimport { ingestRpc, hasRecentSwitch, newFlowState, type FlowState } from \"./shared/flowTracker\";\r\nimport { hexToBigInt, weiToEthString } from \"./shared/txMath\";\r\nimport { weiToEthString as weiToEthFmt } from \"./format\";\r\nimport { getNativeSymbol } from \"./shared/chains\";\r\nimport {\r\n  isRuntimeUsable,\r\n  safeSendMessage,\r\n  safeStorageGet,\r\n  safeGetURL,\r\n  safeLocalGet,\r\n  safeLocalSet,\r\n} from \"./runtimeSafe\";\r\nimport { runPageRiskScan, injectPageRiskBanner } from \"./risk/domScanner\";\r\nimport { renderAdToast, dismissAdToast } from \"./features/adToast\";\r\n\r\nconsole.log(\"\uD83D\uDCE8 [SignGuard Content] Loaded cleanly (No manual injection).\");\r\n\r\n/** Normalize chainId to hex (e.g. 1 -> \"0x1\", \"0x1\" -> \"0x1\"). Returns null if invalid. */\r\nfunction toChainIdHex(chainId: string | number | null | undefined): string | null {\r\n  if (chainId == null || chainId === \"\") return null;\r\n  const s = String(chainId).trim();\r\n  if (s.toLowerCase().startsWith(\"0x\")) return s;\r\n  const n = parseInt(s, 10);\r\n  if (!Number.isFinite(n) || n < 0) return null;\r\n  return \"0x\" + n.toString(16);\r\n}\r\n\r\n// --- UTILS ---\r\nfunction showToast(text: string) {\r\n  try {\r\n    const el = document.createElement(\"div\");\r\n    el.className = \"sg-toast\";\r\n    el.textContent = text;\r\n    document.documentElement.appendChild(el);\r\n    setTimeout(() => el.remove(), 2500);\r\n  } catch {}\r\n}\r\n\r\n// --- VISUALIZA\u00C7\u00C3O (UI) ---\r\ntype OverlayState = {\r\n  requestId: string;\r\n  analysis: Analysis;\r\n  meta: { host: string; method: string; params?: any; rawShape?: string; rpcMeta?: any; chainIdHex?: string | null };\r\n  container: HTMLDivElement;\r\n  shadow: ShadowRoot;\r\n  app: HTMLDivElement;\r\n  onKey: (e: KeyboardEvent) => void;\r\n  countdownTimer?: number | null;\r\n  keepaliveInterval?: number | null;\r\n  analysisLoading?: boolean;\r\n};\r\n\r\nlet __sgOverlay: OverlayState | null = null;\r\n\r\nfunction ensureOverlayCss(shadow: ShadowRoot) {\r\n  try {\r\n    const href = safeGetURL(\"overlay.css\"); // O build move isso para a raiz\r\n    console.log(\"\uD83C\uDFA8 [SignGuard UI] CSS path:\", href);\r\n    if (!href) return;\r\n    const link = document.createElement(\"link\");\r\n    link.rel = \"stylesheet\";\r\n    link.href = href;\r\n    shadow.appendChild(link);\r\n  } catch (e) {\r\n    console.error(\"\uD83C\uDFA8 [SignGuard UI] CSS Error:\", e);\r\n  }\r\n}\r\n\r\nfunction showOverlay(\r\n  requestId: string,\r\n  analysis: Analysis,\r\n  meta: { host: string; method: string; params?: any; rawShape?: string; rpcMeta?: any; chainIdHex?: string | null }\r\n) {\r\n  console.log(\"\uD83C\uDFA8 [SignGuard UI] showOverlay CALLED for:\", requestId);\r\n\r\n  if (__sgOverlay) {\r\n    console.log(\"\uD83C\uDFA8 [SignGuard UI] Updating existing overlay\");\r\n    __sgOverlay.requestId = requestId;\r\n    __sgOverlay.analysis = analysis;\r\n    __sgOverlay.meta = meta;\r\n    updateOverlay(__sgOverlay);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const container = document.createElement(\"div\");\r\n    container.className = \"sg-root\";\r\n    container.setAttribute(\"data-sg-overlay\", \"1\");\r\n    // For\u00E7a visibilidade m\u00E1xima\r\n    container.style.cssText = \"position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 2147483647; pointer-events: none;\";\r\n\r\n    const shadow = container.attachShadow({ mode: \"open\" });\r\n    ensureOverlayCss(shadow);\r\n\r\n    const app = document.createElement(\"div\");\r\n    app.id = \"sg-app\";\r\n    // Habilita pointer-events no conte\u00FAdo\r\n    app.style.pointerEvents = \"auto\";\r\n    shadow.appendChild(app);\r\n\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === \"Escape\") decideCurrentAndAdvance(false);\r\n    };\r\n    document.addEventListener(\"keydown\", onKey);\r\n\r\n    __sgOverlay = { requestId, analysis, meta, container, shadow, app, onKey };\r\n\r\n    if (document.documentElement) {\r\n      document.documentElement.appendChild(container);\r\n      console.log(\"\uD83C\uDFA8 [SignGuard UI] Appended to documentElement\");\r\n    } else {\r\n      document.body.appendChild(container);\r\n      console.log(\"\uD83C\uDFA8 [SignGuard UI] Appended to body\");\r\n    }\r\n\r\n    updateOverlay(__sgOverlay);\r\n  } catch (e) {\r\n    console.error(\"\uD83C\uDFA8 [SignGuard UI] FATAL UI ERROR:\", e);\r\n  }\r\n}\r\n\r\nfunction updateOverlay(state: OverlayState) {\r\n  // Renderiza\u00E7\u00E3o b\u00E1sica para garantir que vemos algo\r\n  state.app.innerHTML = `\r\n    <div style=\"background: #1e293b; color: white; padding: 20px; border-radius: 12px; position: absolute; bottom: 20px; right: 20px; width: 350px; font-family: sans-serif; box-shadow: 0 10px 25px rgba(0,0,0,0.5); border: 1px solid #334155;\">\r\n      <h3 style=\"margin: 0 0 10px 0; color: #38bdf8;\">SignGuard Protege</h3>\r\n      <p style=\"font-size: 14px; margin-bottom: 15px;\">M\u00E9todo: <b>${escapeHtml(state.meta.method)}</b></p>\r\n      <div style=\"display: flex; gap: 10px;\">\r\n        <button id=\"sg-deny\" style=\"flex: 1; padding: 8px; border: none; background: #ef4444; color: white; border-radius: 6px; cursor: pointer;\">Bloquear</button>\r\n        <button id=\"sg-allow\" style=\"flex: 1; padding: 8px; border: none; background: #22c55e; color: white; border-radius: 6px; cursor: pointer;\">Permitir</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const denyBtn = state.shadow.getElementById(\"sg-deny\");\r\n  const allowBtn = state.shadow.getElementById(\"sg-allow\");\r\n  if (denyBtn) denyBtn.addEventListener(\"click\", () => decideCurrentAndAdvance(false));\r\n  if (allowBtn) allowBtn.addEventListener(\"click\", () => decideCurrentAndAdvance(true));\r\n}\r\n\r\nfunction cleanupOverlay() {\r\n  if (__sgOverlay) {\r\n    try { __sgOverlay.container.remove(); } catch {}\r\n    try { document.removeEventListener(\"keydown\", __sgOverlay.onKey); } catch {}\r\n    __sgOverlay = null;\r\n  }\r\n}\r\n\r\n// --- L\u00D3GICA DE DECIS\u00C3O ---\r\n\r\nconst requestQueue: Array<{\r\n  requestId: string;\r\n  method: string;\r\n  host: string;\r\n  params?: any;\r\n  chainIdHex?: string;\r\n  analysis: Analysis | { level: string };\r\n}> = [];\r\n\r\nfunction showCurrentPending() {\r\n  const cur = requestQueue[0];\r\n  if (cur) {\r\n    showOverlay(cur.requestId, cur.analysis as Analysis, {\r\n      host: cur.host,\r\n      method: cur.method,\r\n      params: cur.params,\r\n      chainIdHex: cur.chainIdHex ?? null,\r\n    });\r\n  }\r\n}\r\n\r\nfunction decideCurrentAndAdvance(allow: boolean) {\r\n  const cur = requestQueue[0];\r\n  if (!cur) return;\r\n\r\n  console.log(`\uD83D\uDCE8 [SignGuard Content] User decided: ${allow ? \"ALLOW\" : \"BLOCK\"}`);\r\n\r\n  window.postMessage(\r\n    {\r\n      source: \"signguard-content\",\r\n      type: \"SG_DECISION\",\r\n      requestId: cur.requestId,\r\n      allow,\r\n    },\r\n    \"*\"\r\n  );\r\n\r\n  requestQueue.shift();\r\n  cleanupOverlay();\r\n\r\n  if (requestQueue.length > 0) setTimeout(showCurrentPending, 100);\r\n}\r\n\r\n// --- LISTENER DE MENSAGENS ---\r\n\r\nwindow.addEventListener(\"message\", async (ev) => {\r\n  if (ev.source !== window || !ev.data || ev.data.source !== \"signguard\") return;\r\n  if (ev.data.type !== \"SG_REQUEST\") return;\r\n\r\n  const { requestId, payload } = ev.data;\r\n  console.log(\"\uD83D\uDCE8 [SignGuard Content] Request received:\", payload?.method);\r\n\r\n  const url = payload?.url ?? window.location.href;\r\n  const origin = (() => {\r\n    try { return new URL(url).origin; } catch { return window.location.origin; }\r\n  })();\r\n\r\n  const rpcMeta = (payload as any)?.meta ?? null;\r\n  const chainIdHex =\r\n    (payload as any)?.chainIdHex ||\r\n    toChainIdHex(rpcMeta?.chainId) ||\r\n    toChainIdHex((payload as any)?.chainId) ||\r\n    null;\r\n\r\n  const meta = rpcMeta\r\n    ? { ...rpcMeta, chainIdHex: chainIdHex ?? undefined }\r\n    : chainIdHex\r\n      ? { chainIdHex: chainIdHex ?? undefined }\r\n      : undefined;\r\n\r\n  const analyzePayload: AnalyzeRequest = {\r\n    requestId,\r\n    url,\r\n    origin,\r\n    request: { method: payload?.method ?? \"\", params: Array.isArray(payload?.params) ? payload.params : [] },\r\n    meta,\r\n  };\r\n\r\n  const pending = {\r\n    requestId,\r\n    method: payload?.method ?? \"\",\r\n    host: payload?.host ?? \"\",\r\n    params: payload?.params,\r\n    chainIdHex: chainIdHex ?? undefined,\r\n    analysis: { level: \"LOADING\", score: 0, title: \"\", reasons: [], recommend: \"WARN\" } as unknown as Analysis,\r\n  };\r\n  requestQueue.push(pending);\r\n\r\n  if (requestQueue.length === 1) showCurrentPending();\r\n\r\n  try {\r\n    const response = await safeSendMessage<{ ok?: boolean; analysis?: Analysis }>({\r\n      type: \"ANALYZE\",\r\n      payload: analyzePayload,\r\n    });\r\n\r\n    if (pending.requestId === requestId && response?.analysis) {\r\n      pending.analysis = response.analysis;\r\n\r\n      // --- AUTO-APROVA\u00C7\u00C3O DESABILITADA (PARA TESTE) ---\r\n      // if (response.analysis.recommend === \"ALLOW\") {\r\n      //   decideCurrentAndAdvance(true);\r\n      //   return;\r\n      // }\r\n      // ------------------------------------------------\r\n\r\n      if (__sgOverlay && __sgOverlay.requestId === requestId) {\r\n        __sgOverlay.analysis = response.analysis;\r\n        updateOverlay(__sgOverlay);\r\n      }\r\n    }\r\n  } catch (e) {\r\n    console.error(\"[SignGuard] handleSGRequest crash:\", e);\r\n    console.error(\"[SignGuard] Background comms failed\", e);\r\n  }\r\n});\r\n"],
  "mappings": "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",
  "names": []
}
