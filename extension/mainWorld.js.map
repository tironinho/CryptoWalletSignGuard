{
  "version": 3,
  "sources": ["../src/mainWorld.ts"],
  "sourcesContent": ["// ARQUIVO: src/mainWorld.ts\r\nconst DEBUG_PREFIX = \"\uD83D\uDE80 [SignGuard MainWorld]\";\r\n\r\nfunction log(msg: string, ...args: any[]) {\r\n  console.log(`%c${DEBUG_PREFIX} ${msg}`, \"color: #00ff00; font-weight: bold;\", ...args);\r\n}\r\n\r\nlog(\"Script injected and started.\");\r\n\r\n// Fun\u00E7\u00E3o para patchear o provider\r\nfunction patchProvider(provider: any) {\r\n  if (!provider || provider._sg_patched) return;\r\n\r\n  log(\"Patching found provider:\", provider);\r\n\r\n  const originalRequest = provider.request.bind(provider);\r\n\r\n  // Define um Proxy para interceptar .request\r\n  Object.defineProperty(provider, \"request\", {\r\n    value: async (args: any) => {\r\n      const method = args?.method;\r\n      log(`Intercepted call to: ${method}`, args);\r\n\r\n      // Lista de m\u00E9todos que queremos parar\r\n      const methodsToIntercept = [\r\n        \"eth_sendTransaction\",\r\n        \"eth_signTypedData\",\r\n        \"eth_signTypedData_v3\",\r\n        \"eth_signTypedData_v4\",\r\n        \"personal_sign\",\r\n        \"wallet_switchEthereumChain\"\r\n      ];\r\n\r\n      if (!methodsToIntercept.includes(method)) {\r\n        log(`Passthrough method: ${method}`);\r\n        return originalRequest(args);\r\n      }\r\n\r\n      log(`\uD83D\uDED1 HOLDING Request: ${method}. Sending to Content Script...`);\r\n\r\n      const requestId = crypto.randomUUID();\r\n\r\n      // Envia para o content.ts\r\n      window.postMessage({\r\n        source: \"signguard\",\r\n        type: \"SG_REQUEST\",\r\n        requestId,\r\n        payload: {\r\n          method,\r\n          params: args.params,\r\n          host: window.location.hostname,\r\n          url: window.location.href\r\n        }\r\n      }, \"*\");\r\n\r\n      // Espera resposta\r\n      return new Promise((resolve, reject) => {\r\n        const handler = (ev: MessageEvent) => {\r\n          if (ev.data?.source === \"signguard-content\" &&\r\n              ev.data?.type === \"SG_DECISION\" &&\r\n              ev.data?.requestId === requestId) {\r\n\r\n            log(`\u2705 Decision received for ${requestId}: ${ev.data.allow}`);\r\n            window.removeEventListener(\"message\", handler);\r\n\r\n            if (ev.data.allow) {\r\n              log(\"Executing original request...\");\r\n              originalRequest(args).then(resolve).catch(reject);\r\n            } else {\r\n              log(\"Rejecting request (User Blocked).\");\r\n              reject({ code: 4001, message: \"SignGuard: Blocked by user\" });\r\n            }\r\n          }\r\n        };\r\n        window.addEventListener(\"message\", handler);\r\n      });\r\n    },\r\n    configurable: true,\r\n    writable: true\r\n  });\r\n\r\n  provider._sg_patched = true;\r\n  log(\"Provider patched successfully.\");\r\n}\r\n\r\n// Inicializa\u00E7\u00E3o com m\u00FAltiplas tentativas\r\nfunction init() {\r\n  log(\"Initializing...\");\r\n\r\n  if ((window as any).ethereum) {\r\n    patchProvider((window as any).ethereum);\r\n  }\r\n\r\n  // Monitora inje\u00E7\u00E3o do MetaMask\r\n  let storedEth = (window as any).ethereum;\r\n  Object.defineProperty(window, \"ethereum\", {\r\n    get: () => storedEth,\r\n    set: (val) => {\r\n      log(\"window.ethereum was set externally!\");\r\n      storedEth = val;\r\n      patchProvider(val);\r\n    },\r\n    configurable: true\r\n  });\r\n\r\n  // Polling de seguran\u00E7a (caso o defineProperty falhe)\r\n  setInterval(() => {\r\n    const eth = (window as any).ethereum;\r\n    if (eth && !eth._sg_patched) {\r\n      log(\"Polling found unpatched provider. Patching now...\");\r\n      patchProvider(eth);\r\n    }\r\n  }, 1000);\r\n}\r\n\r\ninit();\r\n"],
  "mappings": ";;;AACA,MAAM,eAAe;AAErB,WAAS,IAAI,QAAgB,MAAa;AACxC,YAAQ,IAAI,KAAK,YAAY,IAAI,GAAG,IAAI,sCAAsC,GAAG,IAAI;AAAA,EACvF;AAEA,MAAI,8BAA8B;AAGlC,WAAS,cAAc,UAAe;AACpC,QAAI,CAAC,YAAY,SAAS,YAAa;AAEvC,QAAI,4BAA4B,QAAQ;AAExC,UAAM,kBAAkB,SAAS,QAAQ,KAAK,QAAQ;AAGtD,WAAO,eAAe,UAAU,WAAW;AAAA,MACzC,OAAO,OAAO,SAAc;AAC1B,cAAM,SAAS,MAAM;AACrB,YAAI,wBAAwB,MAAM,IAAI,IAAI;AAG1C,cAAM,qBAAqB;AAAA,UACzB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF;AAEA,YAAI,CAAC,mBAAmB,SAAS,MAAM,GAAG;AACxC,cAAI,uBAAuB,MAAM,EAAE;AACnC,iBAAO,gBAAgB,IAAI;AAAA,QAC7B;AAEA,YAAI,8BAAuB,MAAM,gCAAgC;AAEjE,cAAM,YAAY,OAAO,WAAW;AAGpC,eAAO,YAAY;AAAA,UACjB,QAAQ;AAAA,UACR,MAAM;AAAA,UACN;AAAA,UACA,SAAS;AAAA,YACP;AAAA,YACA,QAAQ,KAAK;AAAA,YACb,MAAM,OAAO,SAAS;AAAA,YACtB,KAAK,OAAO,SAAS;AAAA,UACvB;AAAA,QACF,GAAG,GAAG;AAGN,eAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,gBAAM,UAAU,CAAC,OAAqB;AACpC,gBAAI,GAAG,MAAM,WAAW,uBACpB,GAAG,MAAM,SAAS,iBAClB,GAAG,MAAM,cAAc,WAAW;AAEpC,kBAAI,gCAA2B,SAAS,KAAK,GAAG,KAAK,KAAK,EAAE;AAC5D,qBAAO,oBAAoB,WAAW,OAAO;AAE7C,kBAAI,GAAG,KAAK,OAAO;AACjB,oBAAI,+BAA+B;AACnC,gCAAgB,IAAI,EAAE,KAAK,OAAO,EAAE,MAAM,MAAM;AAAA,cAClD,OAAO;AACL,oBAAI,mCAAmC;AACvC,uBAAO,EAAE,MAAM,MAAM,SAAS,6BAA6B,CAAC;AAAA,cAC9D;AAAA,YACF;AAAA,UACF;AACA,iBAAO,iBAAiB,WAAW,OAAO;AAAA,QAC5C,CAAC;AAAA,MACH;AAAA,MACA,cAAc;AAAA,MACd,UAAU;AAAA,IACZ,CAAC;AAED,aAAS,cAAc;AACvB,QAAI,gCAAgC;AAAA,EACtC;AAGA,WAAS,OAAO;AACd,QAAI,iBAAiB;AAErB,QAAK,OAAe,UAAU;AAC5B,oBAAe,OAAe,QAAQ;AAAA,IACxC;AAGA,QAAI,YAAa,OAAe;AAChC,WAAO,eAAe,QAAQ,YAAY;AAAA,MACxC,KAAK,MAAM;AAAA,MACX,KAAK,CAAC,QAAQ;AACZ,YAAI,qCAAqC;AACzC,oBAAY;AACZ,sBAAc,GAAG;AAAA,MACnB;AAAA,MACA,cAAc;AAAA,IAChB,CAAC;AAGD,gBAAY,MAAM;AAChB,YAAM,MAAO,OAAe;AAC5B,UAAI,OAAO,CAAC,IAAI,aAAa;AAC3B,YAAI,mDAAmD;AACvD,sBAAc,GAAG;AAAA,MACnB;AAAA,IACF,GAAG,GAAI;AAAA,EACT;AAEA,OAAK;",
  "names": []
}
