{
  "version": 3,
  "sources": ["../src/mainWorld.ts"],
  "sourcesContent": ["// ARQUIVO: src/mainWorld.ts\r\nconst DEBUG_PREFIX = \"\uD83D\uDE80 [SignGuard MainWorld]\";\r\n/** CustomEvent name for decision (synchronous \u2192 preserves user activation for MetaMask). */\r\nconst SG_DECISION_EVENT = \"__sg_decision__\";\r\n\r\nfunction log(msg: string, ...args: any[]) {\r\n  console.log(`%c${DEBUG_PREFIX} ${msg}`, \"color: #00ff00; font-weight: bold;\", ...args);\r\n}\r\n\r\nlog(\"Script injected and started.\");\r\n\r\n// Fun\u00E7\u00E3o para patchear o provider\r\nfunction patchProvider(provider: any) {\r\n  if (!provider || provider._sg_patched) return;\r\n\r\n  log(\"Patching found provider:\", provider);\r\n\r\n  const originalRequest = provider.request.bind(provider);\r\n\r\n  // Define um Proxy para interceptar .request\r\n  Object.defineProperty(provider, \"request\", {\r\n    value: async (args: any) => {\r\n      const method = args?.method;\r\n      log(`Intercepted call to: ${method}`, args);\r\n\r\n      // Lista de m\u00E9todos que queremos parar\r\n      const methodsToIntercept = [\r\n        \"eth_sendTransaction\",\r\n        \"eth_signTypedData\",\r\n        \"eth_signTypedData_v3\",\r\n        \"eth_signTypedData_v4\",\r\n        \"personal_sign\",\r\n        \"wallet_switchEthereumChain\"\r\n      ];\r\n\r\n      if (!methodsToIntercept.includes(method)) {\r\n        log(`Passthrough method: ${method}`);\r\n        return originalRequest(args);\r\n      }\r\n\r\n      log(`\uD83D\uDED1 HOLDING Request: ${method}. Sending to Content Script...`);\r\n\r\n      const requestId = crypto.randomUUID();\r\n\r\n      // Envia para o content.ts\r\n      window.postMessage({\r\n        source: \"signguard\",\r\n        type: \"SG_REQUEST\",\r\n        requestId,\r\n        payload: {\r\n          method,\r\n          params: args.params,\r\n          host: window.location.hostname,\r\n          url: window.location.href\r\n        }\r\n      }, \"*\");\r\n\r\n      // Espera resposta \u2014 via CustomEvent (s\u00EDncrono) para manter user activation e MetaMask abrir\r\n      return new Promise((resolve, reject) => {\r\n        let resolved = false;\r\n        const onDecision = (ev: Event) => {\r\n          const ce = ev as CustomEvent;\r\n          const data = ce?.detail ?? null;\r\n          if (!data || data.type !== \"SG_DECISION\" || data.requestId !== requestId) return;\r\n          if (resolved) return;\r\n          resolved = true;\r\n          window.removeEventListener(SG_DECISION_EVENT, onDecision as EventListener);\r\n          window.removeEventListener(\"message\", onMessage);\r\n\r\n          log(`\u2705 Decision received for ${requestId}: ${data.allow}`);\r\n          if (data.allow) {\r\n            log(\"Executing original request...\");\r\n            originalRequest(args).then(resolve).catch(reject);\r\n          } else {\r\n            log(\"Rejecting request (User Blocked).\");\r\n            reject({ code: 4001, message: \"SignGuard: Blocked by user\" });\r\n          }\r\n        };\r\n        const onMessage = (ev: MessageEvent) => {\r\n          if (resolved) return;\r\n          if (ev.data?.source !== \"signguard-content\" || ev.data?.type !== \"SG_DECISION\" || ev.data?.requestId !== requestId) return;\r\n          resolved = true;\r\n          window.removeEventListener(SG_DECISION_EVENT, onDecision as EventListener);\r\n          window.removeEventListener(\"message\", onMessage);\r\n          log(`\u2705 Decision (fallback postMessage) for ${requestId}: ${ev.data.allow}`);\r\n          if (ev.data.allow) originalRequest(args).then(resolve).catch(reject);\r\n          else reject({ code: 4001, message: \"SignGuard: Blocked by user\" });\r\n        };\r\n        window.addEventListener(SG_DECISION_EVENT, onDecision as EventListener);\r\n        window.addEventListener(\"message\", onMessage);\r\n        // Fallback: se em 3s n\u00E3o chegou por CustomEvent, postMessage ainda pode chegar\r\n        setTimeout(() => {\r\n          if (!resolved) {\r\n            // opcional: poderia remover s\u00F3 o listener de CustomEvent e deixar message\r\n          }\r\n        }, 3000);\r\n      });\r\n    },\r\n    configurable: true,\r\n    writable: true\r\n  });\r\n\r\n  provider._sg_patched = true;\r\n  log(\"Provider patched successfully.\");\r\n}\r\n\r\n// Inicializa\u00E7\u00E3o com m\u00FAltiplas tentativas\r\nfunction init() {\r\n  log(\"Initializing...\");\r\n\r\n  if ((window as any).ethereum) {\r\n    patchProvider((window as any).ethereum);\r\n  }\r\n\r\n  // Monitora inje\u00E7\u00E3o do MetaMask\r\n  let storedEth = (window as any).ethereum;\r\n  Object.defineProperty(window, \"ethereum\", {\r\n    get: () => storedEth,\r\n    set: (val) => {\r\n      log(\"window.ethereum was set externally!\");\r\n      storedEth = val;\r\n      patchProvider(val);\r\n    },\r\n    configurable: true\r\n  });\r\n\r\n  // Polling de seguran\u00E7a (caso o defineProperty falhe)\r\n  setInterval(() => {\r\n    const eth = (window as any).ethereum;\r\n    if (eth && !eth._sg_patched) {\r\n      log(\"Polling found unpatched provider. Patching now...\");\r\n      patchProvider(eth);\r\n    }\r\n  }, 1000);\r\n}\r\n\r\ninit();\r\n"],
  "mappings": "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",
  "names": []
}
