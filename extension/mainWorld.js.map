{
  "version": 3,
  "sources": ["../src/mainWorld.ts"],
  "sourcesContent": ["// src/mainWorld.ts\r\n// SignGuard - Main World (world: \"MAIN\" no manifest). Se rodar em ISOLATED, a extens\u00E3o N\u00C3O funcionar\u00E1.\r\n\r\ntry {\r\n  document.documentElement.dataset.sgMainworld = \"1\";\r\n  window.postMessage({ source: \"signguard-inpage\", type: \"SG_MAINWORLD_READY\", version: \"1.0.0\" }, \"*\");\r\n} catch {}\r\n\r\nconst LOG_PREFIX = \"[SignGuard \uD83D\uDEE1\uFE0F]\";\r\n\r\nfunction log(...args: any[]) {\r\n  // console.log(LOG_PREFIX, ...args); // Descomente para debug\r\n}\r\n\r\n// 1. Interce\u00E7\u00E3o via Proxy (M\u00E9todo Moderno)\r\nfunction patchProvider(provider: any) {\r\n  if (!provider || provider._sg_patched) return;\r\n\r\n  log(\"Patching Provider:\", provider);\r\n\r\n  const originalRequest = provider.request.bind(provider);\r\n\r\n  provider.request = async (args: any) => {\r\n    const method = args?.method;\r\n\r\n    const criticalMethods = [\r\n      \"eth_sendTransaction\",\r\n      \"eth_signTypedData_v4\",\r\n      \"eth_signTypedData_v3\",\r\n      \"personal_sign\",\r\n      \"wallet_switchEthereumChain\",\r\n    ];\r\n\r\n    if (!criticalMethods.includes(method)) {\r\n      return originalRequest(args);\r\n    }\r\n\r\n    log(\"Intercepted:\", method);\r\n\r\n    const requestId = crypto.randomUUID();\r\n\r\n    window.postMessage(\r\n      {\r\n        source: \"signguard\",\r\n        type: \"SG_REQUEST\",\r\n        requestId,\r\n        payload: {\r\n          method,\r\n          params: args?.params,\r\n          host: window.location.hostname,\r\n          url: window.location.href,\r\n        },\r\n      },\r\n      \"*\"\r\n    );\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const handler = (ev: MessageEvent) => {\r\n        const d = ev?.data;\r\n        if (d?.requestId !== requestId || d?.type !== \"SG_DECISION\") return;\r\n        if (d?.source !== \"signguard-content\") return;\r\n        window.removeEventListener(\"message\", handler);\r\n        if (d.allow) {\r\n          originalRequest(args).then(resolve).catch(reject);\r\n        } else {\r\n          reject({ code: 4001, message: \"SignGuard: Blocked by user\" });\r\n        }\r\n      };\r\n      window.addEventListener(\"message\", handler);\r\n    });\r\n  };\r\n\r\n  provider._sg_patched = true;\r\n}\r\n\r\n// 2. Inicializa\u00E7\u00E3o Agressiva\r\nfunction init() {\r\n  if ((window as any).ethereum) {\r\n    patchProvider((window as any).ethereum);\r\n  }\r\n\r\n  let storedEth = (window as any).ethereum;\r\n  try {\r\n    Object.defineProperty(window, \"ethereum\", {\r\n      get: () => storedEth,\r\n      set: (val: any) => {\r\n        storedEth = val;\r\n        patchProvider(val);\r\n      },\r\n      configurable: true,\r\n    });\r\n  } catch {\r\n    // defineProperty pode falhar se j\u00E1 n\u00E3o for configur\u00E1vel; polling cobre\r\n  }\r\n\r\n  setInterval(() => {\r\n    const eth = (window as any).ethereum;\r\n    if (eth && !eth._sg_patched) {\r\n      patchProvider(eth);\r\n    }\r\n  }, 100);\r\n}\r\n\r\ninit();\r\n"],
  "mappings": ";;;AAGA,MAAI;AACF,aAAS,gBAAgB,QAAQ,cAAc;AAC/C,WAAO,YAAY,EAAE,QAAQ,oBAAoB,MAAM,sBAAsB,SAAS,QAAQ,GAAG,GAAG;AAAA,EACtG,QAAQ;AAAA,EAAC;AAIT,WAAS,OAAO,MAAa;AAAA,EAE7B;AAGA,WAAS,cAAc,UAAe;AACpC,QAAI,CAAC,YAAY,SAAS,YAAa;AAEvC,QAAI,sBAAsB,QAAQ;AAElC,UAAM,kBAAkB,SAAS,QAAQ,KAAK,QAAQ;AAEtD,aAAS,UAAU,OAAO,SAAc;AACtC,YAAM,SAAS,MAAM;AAErB,YAAM,kBAAkB;AAAA,QACtB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAEA,UAAI,CAAC,gBAAgB,SAAS,MAAM,GAAG;AACrC,eAAO,gBAAgB,IAAI;AAAA,MAC7B;AAEA,UAAI,gBAAgB,MAAM;AAE1B,YAAM,YAAY,OAAO,WAAW;AAEpC,aAAO;AAAA,QACL;AAAA,UACE,QAAQ;AAAA,UACR,MAAM;AAAA,UACN;AAAA,UACA,SAAS;AAAA,YACP;AAAA,YACA,QAAQ,MAAM;AAAA,YACd,MAAM,OAAO,SAAS;AAAA,YACtB,KAAK,OAAO,SAAS;AAAA,UACvB;AAAA,QACF;AAAA,QACA;AAAA,MACF;AAEA,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,cAAM,UAAU,CAAC,OAAqB;AACpC,gBAAM,IAAI,IAAI;AACd,cAAI,GAAG,cAAc,aAAa,GAAG,SAAS,cAAe;AAC7D,cAAI,GAAG,WAAW,oBAAqB;AACvC,iBAAO,oBAAoB,WAAW,OAAO;AAC7C,cAAI,EAAE,OAAO;AACX,4BAAgB,IAAI,EAAE,KAAK,OAAO,EAAE,MAAM,MAAM;AAAA,UAClD,OAAO;AACL,mBAAO,EAAE,MAAM,MAAM,SAAS,6BAA6B,CAAC;AAAA,UAC9D;AAAA,QACF;AACA,eAAO,iBAAiB,WAAW,OAAO;AAAA,MAC5C,CAAC;AAAA,IACH;AAEA,aAAS,cAAc;AAAA,EACzB;AAGA,WAAS,OAAO;AACd,QAAK,OAAe,UAAU;AAC5B,oBAAe,OAAe,QAAQ;AAAA,IACxC;AAEA,QAAI,YAAa,OAAe;AAChC,QAAI;AACF,aAAO,eAAe,QAAQ,YAAY;AAAA,QACxC,KAAK,MAAM;AAAA,QACX,KAAK,CAAC,QAAa;AACjB,sBAAY;AACZ,wBAAc,GAAG;AAAA,QACnB;AAAA,QACA,cAAc;AAAA,MAChB,CAAC;AAAA,IACH,QAAQ;AAAA,IAER;AAEA,gBAAY,MAAM;AAChB,YAAM,MAAO,OAAe;AAC5B,UAAI,OAAO,CAAC,IAAI,aAAa;AAC3B,sBAAc,GAAG;AAAA,MACnB;AAAA,IACF,GAAG,GAAG;AAAA,EACR;AAEA,OAAK;",
  "names": []
}
